!function(e){function t(e){var t=document.createElement("div");return t.innerHTML=e,t.firstChild.data}function a(e,a,r){var i=document.createElementNS("http://www.w3.org/2000/svg",e);for(var l in a)i.setAttribute(l,a[l]);return r&&(i.textContent=t(r)),i}var r="#999",i="#6bb8b6";prettyNumber=function(e){return exp_number=e.toExponential(),notation_parts=exp_number.split("e"),notation=notation_parts[1],e>=1e9?(notation_string="b",number_part=e/1e9):e>=1e6?(notation_string="m",number_part=e/1e6):e>=1e3?(notation_string="k",number_part=e/1e3):(notation_string="",number_part=e),number_part<10?number_part=Math.round(10*number_part)/10:number_part=Math.round(number_part),number_part+notation_string},e.fn.drawDonut=function(t,i){var l,n,s,o=e(this),p=i.has_key,c=i.has_key?200:100,d=100,h=i.colors,u=c/2,_=d/2,v=Math.min(u,_),f=i.donut_thickness.indexOf("%")>-1?2*v*parseInt(i.donut_thickness)/100:parseInt(i.donut_thickness),g=v-f,m=(i.background_color||"#fff",i.full_donut),x=i.title,y=i.number_decorator||"",w=i.no_text||!1,k=i.goal_value,M=i.goal_value_text||"Remaining",b=i.rounded||!1,j=i.no_tip||!1,L=Math.cos,C=Math.sin,I=Math.PI,P=m?2*I:1.5*I,N=e('<svg width="100%" height="100%" viewBox="0, 0, '+c+", "+d+'" xmlns="http://www.w3.org/2000/svg"></svg>').appendTo(o),A=[],T=0;"undefined"!=typeof i.start_angle?(l=i.start_angle,n=v+v*L(l),s=v-v*C(l)):(l=m?3*I/2:5*I/4,n=m?v:v-v*L(I/4),s=m?2*v:v+v*C(I/4));for(var Z=0;Z<t.length;Z++)T+=t[Z].value;var B=T,H=!1;if(k&&k>T?(t.push({name:M,value:k-T}),0==T&&(H=!0),T=k):1==t.length&&m&&(H=!0),T>0)for(var Z=0;Z<t.length;Z++){var W,X,Y=t[Z],z=Y.value/T*P,E=v+v*L(l-z),O=v-v*C(l-z),S=v+g*L(l-z),D=v-g*C(l-z),F=h[Z%h.length];z>=I?(W="0 1 1",X="0 1 0"):(W="0 0 1",X="0 0 0");var Q,R=0!=Z||m?"0 0 0":"0 0 1";if(H&&m&&Y.value>0)var q=a("circle",{cx:v,cy:v,r:g+f/2,stroke:F,"stroke-width":f,fill:"none","data-title":Y.name,"data-value":Y.value,"class":"graph_piece"});else{Q=b?["M",n,s,"A",v,v,W,E,O,"A",f/2,f/2,"0 1 1",S,D,"A",g,g,X,v+g*L(l),v-g*C(l),"A",f/2,f/2,R,n,s,"Z"]:["M",n,s,"A",v,v,W,E,O,"L",S,D,"A",g,g,X,v+g*L(l),v-g*C(l),"L",n,s,"Z"];var q=a("path",{d:Q.join(" "),fill:F,"data-title":Y.name,"data-value":Y.value,"class":"graph_piece"})}N.append(q),n=E,s=O,l=l-z>0?(l-z)%(2*I):l-z+2*I,A.push({color:F,title:Y.name,percentage:Math.round(100*(Y.value/T))})}if(!w)if(m)var G=a("text",{x:v,y:v,"text-anchor":"middle","class":"center_large"},prettyNumber(B)+y),J=a("text",{x:v,y:v+g/4,fill:r,"text-anchor":"middle","class":"center_small"},x);else var G=a("text",{x:v,y:v+3*g/4+f/2,"text-anchor":"middle","class":"center_large"},prettyNumber(B)+y),J=a("text",{x:v,y:2*v-f/2,fill:r,"text-anchor":"middle","class":"center_small"},x);if(N.append(G),N.append(J),p)for(var K=d/A.length,U=Math.min(5,K),Z=0;Z<A.length;Z++){var V=A[Z],$=a("circle",{cx:u+2*U,cy:Z*K+U,r:U,fill:V.color,"class":"key_circle"}),ee=a("text",{x:u+4*U,y:Z*K+1.5*U,fill:r,"class":"key_text"},V.title+" ("+V.percentage+"%)");N.append($),N.append(ee)}if(!j){var te=e('<div class="chart_tip"><span class="title"></span><span class="value"></span></div>').appendTo("body");o.on("mouseover","path.graph_piece, circle.graph_piece",function(t){te.find("span.title").html(e(this).data("title")),te.find("span.value").text(prettyNumber(e(this).data("value"))+y),te.show()}),o.on("mouseleave","path.graph_piece, circle.graph_piece",function(e){te.hide()}),o.on("mousemove","path.graph_piece, circle.graph_piece",function(e){te.css({left:e.pageX-te.outerWidth()/2+"px",top:e.pageY-te.outerHeight(!0)+"px"})})}return o.addClass("chart").addClass("donut_chart"),p&&o.addClass("has_key"),o},e.fn.drawPie=function(t,i){for(var l=e(this),n=i.has_key?200:100,s=100,o=i.colors,p=n/2,c=s/2,d=i.title,h=i.has_key,u=d?10:0,_=Math.min(p,c-u),v=Math.cos,f=Math.sin,g=Math.PI,m=2*g,x=e('<svg width="100%" height="100%" viewBox="0, 0, '+n+", "+s+'" xmlns="http://www.w3.org/2000/svg"></svg>').appendTo(l),y=!1,w=[],k=0,M=_,b=u+_+_,j=3*g/2,L=0;L<t.length;L++)k+=t[L].value;if(1==t.length&&(y=!0),k>0)for(var L=0;L<t.length;L++){var C,I,P=t[L],N=P.value/k*m,A=_+_*v(j-N),T=u+_-_*f(j-N),Z=o[L%o.length];if(y=P.value==k?!0:!1,j>g/2&&3*g/2>=j?N>=g?(C="0 1 1",I="0 1 0"):(C="0 0 1",I="0 0 0"):N>=g?(C="0 0 1",I="0 0 0"):(C="0 0 1",I="0 0 0"),P.value>0)if(y)var B=a("circle",{cx:_,cy:_+u,r:_,fill:Z,"data-title":P.name,"data-value":P.value,"class":"graph_piece"});else var H=["M",_,_+u,"L",M,b,"A",_,_,C,A,T,"L",_,_+u,"Z"],B=a("path",{d:H.join(" "),fill:Z,"data-title":P.name,"data-value":P.value,"class":"graph_piece"});x.append(B),M=A,b=T,j-=N,w.push({color:Z,title:P.name,percentage:Math.round(100*(P.value/k))})}if(h)for(var W=(s-u)/w.length,X=Math.min(5,W),L=0;L<w.length;L++){var Y=w[L],z=a("circle",{cx:p+2*X,cy:u+L*W+X,r:X,fill:Y.color,"class":"key_circle"}),E=a("text",{x:p+4*X,y:u+L*W+1.5*X,fill:r,"class":"key_text"},Y.title+" ("+Y.percentage+"%)");x.append(z),x.append(E)}if(d){var O=a("text",{x:n/2,y:5,fill:r,"text-anchor":"middle","class":"key_text"},d);x.append(O)}var S=e('<div class="chart_tip"><span class="title"></span><span class="value"></span></div>').appendTo("body");return l.on("mouseover","path.graph_piece, circle.graph_piece",function(t){S.find("span.title").html(e(this).data("title")),S.find("span.value").text(prettyNumber(e(this).data("value"))),S.show()}),l.on("mouseleave","path.graph_piece, circle.graph_piece",function(e){S.hide()}),l.on("mousemove","path.graph_piece, circle.graph_piece",function(e){S.css({left:e.pageX-S.outerWidth()/2+"px",top:e.pageY-S.outerHeight(!0)+"px"})}),l.addClass("chart").addClass("pie_chart"),h&&l.addClass("has_key"),l},e.fn.drawSkew=function(t,i){var l=e(this),n=i.has_key?200:100,s=100,o=i.colors,p=i.border_color,c=i.data_max||10,d=i.show_fit;fit_master=i.fit_master||0,fit_comparison=(fit_master+1)%2,title=i.title,has_key=i.has_key,edge_tooltips=i.edge_tooltips||!1,categories=i.categories||!1,categories_colors=i.categories_colors,dot_radius=1.5,offset_top=title?10:2*dot_radius,offset_bottom=d?10:2*dot_radius,center_x=n/2,center_y=s/2,inner_radius=Math.min(center_x-2*dot_radius,center_y-(offset_top+offset_bottom)/2),outer_radius=inner_radius+2*dot_radius,start_x=i.has_key?inner_radius+dot_radius:center_x,start_y=inner_radius+offset_top,cos=Math.cos,sin=Math.sin,PI=Math.PI,total_radians=2*PI;var h=e('<svg width="100%" height="100%" viewBox="0, 0, '+n+", "+s+'" xmlns="http://www.w3.org/2000/svg"></svg>').appendTo(l),u=a("circle",{cx:start_x,cy:start_y,r:inner_radius,stroke:p,"stroke-width":"0.5%",fill:"none"});h.append(u);for(var _=[],v=t[0].values.length,f=2*PI/v,g="",m=1*PI/2,x=0,y=[],w=[],k={},M=m,b=0,j=0;j<t[0].values.length;j++){var L=t[0].values[j],C=start_x+inner_radius*cos(M),I=start_y-inner_radius*sin(M);if(edge_tooltips){var P=a("circle",{cx:C,cy:I,r:dot_radius,fill:p,"data-title":L.name,"data-value":y[j].join("<br/>"),"class":"graph_piece"});h.append(P),M+=f}if(categories){if("string"==typeof L.category)var N=L.category,A="";else if("object"==typeof L.category)var N=L.category.name,A=L.category.subtitle;N in k?k[N].length+=1:(k[N]={length:1,color:categories_colors[b%categories_colors.length],value:A},b++)}d&&2==t.length&&(x+=1-Math.max(t[fit_master].values[j].value-t[fit_comparison].values[j].value,0)/c)}if(categories&&k){var T=m+PI/v,Z=start_x+outer_radius*cos(T);category_start_y=start_y-outer_radius*sin(T);for(var N in k)if(k.hasOwnProperty(N)){var B,H,W=k[N],X=W.length/v*total_radians,Y=start_x+outer_radius*cos(T-X),z=start_y-outer_radius*sin(T-X),E=start_x+inner_radius*cos(T-X),O=start_y-inner_radius*sin(T-X),S=W.color;X>=PI?(B="0 1 1",H="0 1 0"):(B="0 0 1",H="0 0 0");var D;if(1==b)var P=a("circle",{cx:start_x,cy:start_y,r:inner_radius+dot_radius,stroke:S,"stroke-width":2*dot_radius,fill:"none","data-title":N,"data-value":W.value,"class":"graph_piece"});else{D=["M",Z,category_start_y,"A",outer_radius,outer_radius,B,Y,z,"L",E,O,"A",inner_radius,inner_radius,H,start_x+inner_radius*cos(T),start_y-inner_radius*sin(T),"L",Z,category_start_y,"Z"];var P=a("path",{d:D.join(" "),fill:S,"data-title":N,"data-value":W.value,"class":"graph_piece"})}h.append(P),Z=Y,category_start_y=z,T=T-X>0?(T-X)%(2*PI):T-X+2*PI}}for(var F=0;F<t.length;F++){for(var g=[],Q=t[F].title,R=m,j=0;j<t[F].values.length;j++){var L=t[F].values[j],C=start_x+inner_radius*L.value/c*cos(R),I=start_y-inner_radius*L.value/c*sin(R),S=o[F%o.length];if(g.push(C+","+I),R+=f,edge_tooltips)y[j]?y[j].push(Q+": "+L.value+"/"+c):y[j]=[Q+": "+L.value+"/"+c];else{var q=a("circle",{cx:C,cy:I,r:dot_radius,fill:S,"data-title":L.name,"data-value":Q+": "+L.value+"/"+c,"class":"graph_piece"});w.push(q)}}var P=a("polygon",{points:g.join(" "),fill:S,"fill-opacity":.5,stroke:S,"stroke-width":"0.5%","data-title":L.name,"data-value":L.value,"class":"graph_piece"});if(h.append(P),!edge_tooltips)for(var j=0;j<w.length;j++)h.append(w[j]);_.push({color:S,title:t[F].title})}if(has_key)for(var G=(s-offset_top)/_.length,J=Math.min(5,G),F=0;F<_.length;F++){var K=_[F],U=a("circle",{cx:center_x+2*J,cy:offset_top+F*G+J,r:J,fill:K.color,"class":"key_circle"}),V=a("text",{x:center_x+4*J,y:offset_top+F*G+1.5*J,fill:r,"class":"key_text"},K.title);h.append(U),h.append(V)}if(title){var $=a("text",{x:n/2,y:5,fill:r,"text-anchor":"middle","class":"key_text"},title);h.append($)}if(d){var ee=prettyNumber(100*x/v),te="Fit: "+ee+"%",ae=a("text",{x:n/2,y:s-2,fill:r,"text-anchor":"middle","class":"key_text"},te);h.append(ae)}var re=e('<div class="chart_tip"><span class="title"></span><span class="value"></span></div>').appendTo("body");return l.on("mouseover","path.graph_piece, circle.graph_piece",function(t){re.find("span.title").html(e(this).data("title")),e(this).data("value")&&!isNaN(e(this).data("value"))?re.find("span.value").text(prettyNumber(e(this).data("value"))):re.find("span.value").html(e(this).data("value")),re.show()}),l.on("mouseleave","path.graph_piece, circle.graph_piece",function(e){re.hide()}),l.on("mousemove","path.graph_piece, circle.graph_piece",function(e){re.css({left:e.pageX-re.outerWidth()/2+"px",top:e.pageY-re.outerHeight(!0)+"px"})}),l.addClass("chart").addClass("skew_chart"),has_key&&l.addClass("has_key"),l},e.fn.drawBar=function(t,l){for(var n,s=e(this),o=l.aspect_ratio?l.aspect_ratio:2,p=100*o,c=100,d=parseInt(l.bar_spacing),h=l.colors,u=(l.background_color||"#fff",l.title),_=l.hover,v=l.rounded_tops,f=l.average_line,g="undefined"==typeof l.goal_value?null:l.goal_value,m="undefined"==typeof l.height_adjustment?0:l.height_adjustment,x=(Math.cos,Math.sin,Math.PI,e('<svg width="100%" height="100%" viewBox="0, 0, '+p+", "+c+'" xmlns="http://www.w3.org/2000/svg"></svg>').appendTo(s)),y=f||null!==g?16:0,w=f||null!==g?8:0,k=p-y,M=_&&!u?c:c-10,b=M-10,j=0,L=1+m,C=p-k+d/2,I=M,P=(k-t.length*d)/t.length,N=0;N<t.length;N++)j+=t[N].value,t[N].value+m>L&&(L=t[N].value+m);if(f||null!==g){var A;f?(n=j/t.length,A=b*(n+m)/L):(n=g,A=b*(g+m)/L);var T=a("rect",{x:p-k,y:I-A,width:k,height:A,fill:"rgba(0, 0, 0, 0.1)"});x.append(T);var Z=["M",p-k,I-A,"L",p-k-w/2,I-A+w/2,"L",0,I-A+w/2,"L",0,I-A-w/2,"L",y-w/2,I-A-w/2,"Z"],B=a("path",{d:Z.join(" "),fill:i,"class":"goal_indicator"});x.append(B);var H=a("text",{x:(y-w/2)/2,y:I-A+w/2-2,"text-anchor":"middle",fill:"#fff","class":"goal_indicator_text"},prettyNumber(n));x.append(H)}if("undefined"!=typeof n)for(var N=0;N<t.length;N++){var W=t[N],X=b*Math.min(W.value+m,n+m)/L,Y=b*(W.value+m)/L,z=h[0],E=h[h.length-1],O=_?"graph_piece":"";if(Y>X){var S=I-X,D=Y-X,F=["M",C,S,"L",C,S-D+Math.min(P/2,D),"A",P/2,Math.min(P/2,D),"0 0 1",C+P,S-D+Math.min(P/2,D),"L",C+P,S,"Z"],Q=a("path",{d:F.join(" "),fill:E,"data-title":W.name,"data-value":W.value,"class":O});x.append(Q)}var R=["M",C,I,"L",C,I-X,"L",C+P,I-X,"L",C+P,I,"Z"],q=a("path",{d:R.join(" "),fill:z,"data-title":W.name,"data-value":W.value,"class":O});if(x.append(q),!_){var G=a("text",{x:C+P/2,y:I-Y-1,fill:r,"text-anchor":"middle","class":"key_text"},prettyNumber(W.value)),J=a("text",{x:C+P/2,y:c-1,fill:r,"text-anchor":"middle","class":"key_text"},W.name);x.append(G),x.append(J)}C+=P+d}else for(var N=0;N<t.length;N++){var W=t[N],Y=b*(W.value+m)/L,K=h[N%h.length],O=_?"graph_piece":"";if(v)var U=["M",C,I,"L",C,I-Y+Math.min(P/2,Y),"A",P/2,Math.min(P/2,Y),"0 0 1",C+P,I-Y+Math.min(P/2,Y),"L",C+P,I,"Z"];else var U=["M",C,I,"L",C,I-Y,"L",C+P,I-Y,"L",C+P,I,"Z"];var V=a("path",{d:U.join(" "),fill:K,"data-title":W.name,"data-value":W.value,"class":O});if(Y>0&&x.append(V),!_){var G=a("text",{x:C+P/2,y:I-Y-1,fill:r,"text-anchor":"middle","class":"key_text"},prettyNumber(W.value)),J=a("text",{x:C+P/2,y:c-1,fill:r,"text-anchor":"middle","class":"key_text"},W.name);x.append(G),x.append(J)}C+=P+d}if(_&&u)var $=a("text",{x:p/2,y:c-2,fill:r,"text-anchor":"middle","class":"key_text"},u);if(x.append($),_){var ee=e('<div class="chart_tip"><span class="title"></span><span class="value"></span></div>').appendTo("body");s.on("mouseover","path.graph_piece",function(t){ee.find("span.title").html(e(this).data("title")),ee.find("span.value").text(prettyNumber(e(this).data("value"))),ee.show()}),s.on("mouseleave","path.graph_piece",function(e){ee.hide()}),s.on("mousemove","path.graph_piece",function(e){ee.css({left:e.pageX-ee.outerWidth()/2+"px",top:e.pageY-ee.outerHeight(!0)+"px"})})}return s.addClass("chart").addClass("bar_chart"),s},e.fn.drawLine=function(t,i){var l=e(this),n=i.aspect_ratio?i.aspect_ratio:2,s=100*n,o=100,p=i.colors,c="undefined"==typeof i.show_area_color?!0:i.show_area_color;background_color=i.background_color||"#fff",title=i.title,hover=i.hover,dot_radius=1.5,separate_scales="undefined"==typeof i.separate_scales?!1:i.separate_scales,zoom_y="undefined"==typeof i.zoom_y?0:i.zoom_y,height_adjustment="undefined"==typeof i.height_adjustment?1:i.height_adjustment,cos=Math.cos,sin=Math.sin,PI=Math.PI;for(var d=e('<svg width="100%" height="100%" viewBox="0, 0, '+s+", "+o+'" xmlns="http://www.w3.org/2000/svg"></svg>').appendTo(l),h=s-2*dot_radius,u=hover&&!title?o:o-10,_=u-10,v=null,f=null,g=[],m=[],x=0;x<t.length;x++){g.push(null),m.push(null);for(var y=0;y<t[x].length;y++)(null==v||t[x][y].value>v)&&(v=t[x][y].value),(null==f||t[x][y].value<f)&&(f=t[x][y].value),(null==g[x]||t[x][y].value>g[x])&&(g[x]=t[x][y].value),(null==m[x]||t[x][y].value<m[x])&&(m[x]=t[x][y].value)}height_adjustment=Math.max(-1*f,height_adjustment),v+=height_adjustment,f+=height_adjustment;for(var w=[],x=0;x<t.length;x++)w[x]=Math.max(-1*m[x],height_adjustment),g[x]=g[x]+height_adjustment,m[x]=m[x]+height_adjustment;for(var M=[],x=0;x<t.length;x++){for(var b=t[x].length>1?h/(t[x].length-1):h,j=(s-h)/2,L=[],C=p[x],I=separate_scales?g[x]:v,P=separate_scales?m[x]:f,N=separate_scales?w[x]:height_adjustment,y=0;y<t[x].length;y++){var A=t[x][y],T=j,Z=u-_*(A.value+N-P*zoom_y)/(I-P*zoom_y),B=A.value;A.hasOwnProperty("tooltip_value")&&(B=A.tooltip_value.constructor==Array?A.tooltip_value.join(", "):A.tooltip_value),L.push(T+","+Z);var H=a("circle",{cx:T,cy:Z,r:dot_radius,fill:C,"data-title":A.name,"data-value":B,"class":"graph_piece"});M.push(H),j+=b}var W=a("polyline",{points:L.join(" "),fill:"none","fill-opacity":.5,stroke:C,"stroke-width":"0.5%"});if(d.append(W),c){var X=dot_radius+","+u,Y=dot_radius+h+","+u,z=a("polygon",{points:X+" "+L.join(" ")+" "+Y,fill:C,"fill-opacity":.5});d.append(z)}}for(k=0;k<M.length;k++)d.append(M[k]);if(hover&&title)var E=a("text",{x:s/2,y:o-2,fill:r,"text-anchor":"middle","class":"key_text large"},title);if(d.append(E),hover){var O=e('<div class="chart_tip"><span class="title"></span><span class="value"></span></div>').appendTo("body");l.on("mouseover","polygon.graph_piece, circle.graph_piece",function(t){O.find("span.title").html(e(this).data("title")),O.find("span.value").text(e(this).data("value")),O.show()}),l.on("mouseleave","polygon.graph_piece, circle.graph_piece",function(e){O.hide()}),l.on("mousemove","polygon.graph_piece, circle.graph_piece",function(e){O.css({left:e.pageX-O.outerWidth()/2+"px",top:e.pageY-O.outerHeight(!0)+"px"})})}return l.addClass("chart").addClass("line_chart"),l},e.fn.drawComparison=function(t,i){for(var l=e(this),n=i.aspect_ratio?i.aspect_ratio:1,s=100*n,o=100,p=i.colors,c=i.shapes,d=(i.background_color||"#fff",i.title),h=i.hover,u=h?"graph_piece":"",_=(Math.cos,Math.sin,Math.PI,e('<svg width="100%" height="100%" viewBox="0, 0, '+s+", "+o+'" xmlns="http://www.w3.org/2000/svg"></svg>').appendTo(l)),v=0,f=0,g=0;g<t.length;g++)v+=t[g].value;var m=0,x=h&&!d?o:o-10,y=x;if(v>0)for(var g=0;g<t.length;g++){var w=t[g],k=p[g%p.length],M=c[g%c.length],b=Math.round(w.value/v*100)/100,j=w.value/v*(x/100),L=Math.round(j*s*100)/100,C=Math.round(j*o*100)/100;f+=b,f>1&&(b-=.01);var I=a("path",{d:M,fill:k,"data-title":w.name,"data-value":Math.round(100*b)+"%","class":u,transform:"translate("+m+", "+(y-C)+"), scale("+j+")"});if(_.append(I),!h){var P=a("text",{x:m+L/2,y:y-C-1,fill:r,"text-anchor":"middle","class":"key_text large"},Math.round(100*b)+"%"),N=a("text",{x:m+L/2,y:o-1,fill:r,"text-anchor":"middle","class":"key_text"},w.name);_.append(P),_.append(N)}m+=L,d&&(m+=10/(t.length-1))}if(h&&d)var A=a("text",{x:s/2,y:o-2,fill:r,"text-anchor":"middle","class":"key_text"},d);if(_.append(A),h){var T=e('<div class="chart_tip"><span class="title"></span><span class="value"></span></div>').appendTo("body");l.on("mouseover","path.graph_piece",function(t){T.find("span.title").html(e(this).data("title")),T.find("span.value").text(e(this).data("value")),T.show()}),l.on("mouseleave","path.graph_piece",function(e){T.hide()}),l.on("mousemove","path.graph_piece",function(e){T.css({left:e.pageX-T.outerWidth()/2+"px",top:e.pageY-T.outerHeight(!0)+"px"})})}return l.addClass("chart").addClass("comparison_chart"),l}}(jQuery);
