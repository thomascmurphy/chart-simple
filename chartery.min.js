!function(e){function t(e){var t=document.createElement("div");return t.innerHTML=e,t.firstChild.data}function a(e,a,r){var l=document.createElementNS("http://www.w3.org/2000/svg",e);for(var i in a)l.setAttribute(i,a[i]);return r&&(l.textContent=t(r)),l}var r="#999",l="#6bb8b6";prettyNumber=function(e){return exp_number=e.toExponential(),notation_parts=exp_number.split("e"),notation=notation_parts[1],e>=1e9?(notation_string="b",number_part=e/1e9):e>=1e6?(notation_string="m",number_part=e/1e6):e>=1e3?(notation_string="k",number_part=e/1e3):(notation_string="",number_part=e),number_part<10?number_part=Math.round(10*number_part)/10:number_part=Math.round(number_part),number_part+notation_string},e.fn.drawDonut=function(t,l){var i,n,s,o=e(this),p=l.has_key,c=l.has_key?200:100,d=100,h=l.colors,u=c/2,v=d/2,_=Math.min(u,v),f=l.donut_thickness.indexOf("%")>-1?2*_*parseInt(l.donut_thickness)/100:parseInt(l.donut_thickness),g=_-f,x=(l.background_color||"#fff",l.full_donut),m=l.title,y=l.number_decorator||"",w=l.no_text||!1,k=l.goal_value,M=l.goal_value_text||"Remaining",b=l.rounded||!1,L=l.no_tip||!1,j=Math.cos,C=Math.sin,I=Math.PI,P=x?2*I:1.5*I,N=e('<svg width="100%" height="100%" viewBox="0, 0, '+c+", "+d+'" xmlns="http://www.w3.org/2000/svg"></svg>').appendTo(o),A=[],T=0;"undefined"!=typeof l.start_angle?(i=l.start_angle,n=_+_*j(i),s=_-_*C(i)):(i=x?3*I/2:5*I/4,n=x?_:_-_*j(I/4),s=x?2*_:_+_*C(I/4));for(var Z=0;Z<t.length;Z++)T+=t[Z].value;var B=T,H=!1;if(k&&k>T?(t.push({name:M,value:k-T}),0==T&&(H=!0),T=k):1==t.length&&x&&(H=!0),T>0)for(var Z=0;Z<t.length;Z++){var W,X,Y=t[Z],E=Y.value/T*P,O=_+_*j(i-E),S=_-_*C(i-E),D=_+g*j(i-E),F=_-g*C(i-E),Q=h[Z%h.length];E>=I?(W="0 1 1",X="0 1 0"):(W="0 0 1",X="0 0 0");var R,q=0!=Z||x?"0 0 0":"0 0 1";if(H&&x&&Y.value>0)var z=a("circle",{cx:_,cy:_,r:g+f/2,stroke:Q,"stroke-width":f,fill:"none","data-title":Y.name,"data-value":Y.value,"class":"graph_piece"});else{R=b?["M",n,s,"A",_,_,W,O,S,"A",f/2,f/2,"0 1 1",D,F,"A",g,g,X,_+g*j(i),_-g*C(i),"A",f/2,f/2,q,n,s,"Z"]:["M",n,s,"A",_,_,W,O,S,"L",D,F,"A",g,g,X,_+g*j(i),_-g*C(i),"L",n,s,"Z"];var z=a("path",{d:R.join(" "),fill:Q,"data-title":Y.name,"data-value":Y.value,"class":"graph_piece"})}N.append(z),n=O,s=S,i=i-E>0?(i-E)%(2*I):i-E+2*I,A.push({color:Q,title:Y.name,percentage:Math.round(100*(Y.value/T))})}if(!w)if(x)var G=a("text",{x:_,y:_,"text-anchor":"middle","class":"center_large"},prettyNumber(B)+y),J=a("text",{x:_,y:_+g/4,fill:r,"text-anchor":"middle","class":"center_small"},m);else var G=a("text",{x:_,y:_+3*g/4+f/2,"text-anchor":"middle","class":"center_large"},prettyNumber(B)+y),J=a("text",{x:_,y:2*_-f/2,fill:r,"text-anchor":"middle","class":"center_small"},m);if(N.append(G),N.append(J),p)for(var K=d/A.length,U=Math.min(5,K),Z=0;Z<A.length;Z++){var V=A[Z],$=a("circle",{cx:u+2*U,cy:Z*K+U,r:U,fill:V.color,"class":"key_circle"}),ee=a("text",{x:u+4*U,y:Z*K+1.5*U,fill:r,"class":"key_text"},V.title+" ("+V.percentage+"%)");N.append($),N.append(ee)}if(!L){var te=e('<div class="chart_tip"><span class="title"></span><span class="value"></span></div>').appendTo("body");o.on("mouseover","path.graph_piece, circle.graph_piece",function(t){te.find("span.title").html(e(this).data("title")),te.find("span.value").text(prettyNumber(e(this).data("value"))+y),te.show()}),o.on("mouseleave","path.graph_piece, circle.graph_piece",function(e){te.hide()}),o.on("mousemove","path.graph_piece, circle.graph_piece",function(e){te.css({left:e.pageX-te.outerWidth()/2+"px",top:e.pageY-te.outerHeight(!0)+"px"})})}return o.addClass("chart").addClass("donut_chart"),p&&o.addClass("has_key"),o},e.fn.drawPie=function(t,l){for(var i=e(this),n=l.has_key?200:100,s=100,o=l.colors,p=n/2,c=s/2,d=l.title,h=l.has_key,u=d?10:0,v=Math.min(p,c-u),_=Math.cos,f=Math.sin,g=Math.PI,x=2*g,m=e('<svg width="100%" height="100%" viewBox="0, 0, '+n+", "+s+'" xmlns="http://www.w3.org/2000/svg"></svg>').appendTo(i),y=!1,w=[],k=0,M=v,b=u+v+v,L=3*g/2,j=0;j<t.length;j++)k+=t[j].value;if(1==t.length&&(y=!0),k>0)for(var j=0;j<t.length;j++){var C,I,P=t[j],N=P.value/k*x,A=v+v*_(L-N),T=u+v-v*f(L-N),Z=o[j%o.length];if(y=P.value==k?!0:!1,L>g/2&&3*g/2>=L?N>=g?(C="0 1 1",I="0 1 0"):(C="0 0 1",I="0 0 0"):N>=g?(C="0 0 1",I="0 0 0"):(C="0 0 1",I="0 0 0"),P.value>0)if(y)var B=a("circle",{cx:v,cy:v+u,r:v,fill:Z,"data-title":P.name,"data-value":P.value,"class":"graph_piece"});else var H=["M",v,v+u,"L",M,b,"A",v,v,C,A,T,"L",v,v+u,"Z"],B=a("path",{d:H.join(" "),fill:Z,"data-title":P.name,"data-value":P.value,"class":"graph_piece"});m.append(B),M=A,b=T,L-=N,w.push({color:Z,title:P.name,percentage:Math.round(100*(P.value/k))})}if(h)for(var W=(s-u)/w.length,X=Math.min(5,W),j=0;j<w.length;j++){var Y=w[j],E=a("circle",{cx:p+2*X,cy:u+j*W+X,r:X,fill:Y.color,"class":"key_circle"}),O=a("text",{x:p+4*X,y:u+j*W+1.5*X,fill:r,"class":"key_text"},Y.title+" ("+Y.percentage+"%)");m.append(E),m.append(O)}if(d){var S=a("text",{x:n/2,y:5,fill:r,"text-anchor":"middle","class":"key_text"},d);m.append(S)}var D=e('<div class="chart_tip"><span class="title"></span><span class="value"></span></div>').appendTo("body");return i.on("mouseover","path.graph_piece, circle.graph_piece",function(t){D.find("span.title").html(e(this).data("title")),D.find("span.value").text(prettyNumber(e(this).data("value"))),D.show()}),i.on("mouseleave","path.graph_piece, circle.graph_piece",function(e){D.hide()}),i.on("mousemove","path.graph_piece, circle.graph_piece",function(e){D.css({left:e.pageX-D.outerWidth()/2+"px",top:e.pageY-D.outerHeight(!0)+"px"})}),i.addClass("chart").addClass("pie_chart"),h&&i.addClass("has_key"),i},e.fn.drawSkew=function(t,l){var i=e(this),n=l.has_key?200:100,s=100,o=l.colors,p=l.border_color,c=l.data_max||10,d=l.show_fit;fit_master=l.fit_master||0,fit_comparison=(fit_master+1)%2,title=l.title,has_key=l.has_key,edge_tooltips=l.edge_tooltips||!1,categories=l.categories||!1,categories_colors=l.categories_colors,dot_radius=1.5,offset_top=title?10:2*dot_radius,offset_bottom=d?10:2*dot_radius,center_x=n/2,center_y=s/2,inner_radius=Math.min(center_x-2*dot_radius,center_y-(offset_top+offset_bottom)/2),outer_radius=inner_radius+2*dot_radius,start_x=l.has_key?inner_radius+dot_radius:center_x,start_y=inner_radius+offset_top,cos=Math.cos,sin=Math.sin,PI=Math.PI,total_radians=2*PI;var h=e('<svg width="100%" height="100%" viewBox="0, 0, '+n+", "+s+'" xmlns="http://www.w3.org/2000/svg"></svg>').appendTo(i),u=a("circle",{cx:start_x,cy:start_y,r:inner_radius,stroke:p,"stroke-width":"0.5%",fill:"none"});h.append(u);for(var v=[],_=t[0].values.length,f=2*PI/_,g="",x=1*PI/2,m=0,y=[],w=[],k={},M=x,b=0,L=0;L<t[0].values.length;L++){var j=t[0].values[L],C=start_x+inner_radius*cos(M),I=start_y-inner_radius*sin(M);if(edge_tooltips){var P=a("circle",{cx:C,cy:I,r:dot_radius,fill:p,"data-title":j.name,"data-value":y[L].join("<br/>"),"class":"graph_piece"});h.append(P),M+=f}if(categories){if("string"==typeof j.category)var N=j.category,A="";else if("object"==typeof j.category)var N=j.category.name,A=j.category.subtitle;N in k?k[N].length+=1:(k[N]={length:1,color:categories_colors[b%categories_colors.length],value:A},b++)}d&&2==t.length&&(m+=1-Math.max(t[fit_master].values[L].value-t[fit_comparison].values[L].value,0)/c)}if(categories&&k){var T=x+PI/_,Z=start_x+outer_radius*cos(T);category_start_y=start_y-outer_radius*sin(T);for(var N in k)if(k.hasOwnProperty(N)){var B,H,W=k[N],X=W.length/_*total_radians,Y=start_x+outer_radius*cos(T-X),E=start_y-outer_radius*sin(T-X),O=start_x+inner_radius*cos(T-X),S=start_y-inner_radius*sin(T-X),D=W.color;X>=PI?(B="0 1 1",H="0 1 0"):(B="0 0 1",H="0 0 0");var F;if(1==b)var P=a("circle",{cx:start_x,cy:start_y,r:inner_radius+dot_radius,stroke:D,"stroke-width":2*dot_radius,fill:"none","data-title":N,"data-value":W.value,"class":"graph_piece"});else{F=["M",Z,category_start_y,"A",outer_radius,outer_radius,B,Y,E,"L",O,S,"A",inner_radius,inner_radius,H,start_x+inner_radius*cos(T),start_y-inner_radius*sin(T),"L",Z,category_start_y,"Z"];var P=a("path",{d:F.join(" "),fill:D,"data-title":N,"data-value":W.value,"class":"graph_piece"})}h.append(P),Z=Y,category_start_y=E,T=T-X>0?(T-X)%(2*PI):T-X+2*PI}}for(var Q=0;Q<t.length;Q++){for(var g=[],R=t[Q].title,q=x,L=0;L<t[Q].values.length;L++){var j=t[Q].values[L],C=start_x+inner_radius*j.value/c*cos(q),I=start_y-inner_radius*j.value/c*sin(q),D=o[Q%o.length];if(g.push(C+","+I),q+=f,edge_tooltips)y[L]?y[L].push(R+": "+j.value+"/"+c):y[L]=[R+": "+j.value+"/"+c];else{var z=a("circle",{cx:C,cy:I,r:dot_radius,fill:D,"data-title":j.name,"data-value":R+": "+j.value+"/"+c,"class":"graph_piece"});w.push(z)}}var P=a("polygon",{points:g.join(" "),fill:D,"fill-opacity":.5,stroke:D,"stroke-width":"0.5%","data-title":j.name,"data-value":j.value,"class":"graph_piece"});if(h.append(P),!edge_tooltips)for(var L=0;L<w.length;L++)h.append(w[L]);v.push({color:D,title:t[Q].title})}if(has_key)for(var G=(s-offset_top)/v.length,J=Math.min(5,G),Q=0;Q<v.length;Q++){var K=v[Q],U=a("circle",{cx:center_x+2*J,cy:offset_top+Q*G+J,r:J,fill:K.color,"class":"key_circle"}),V=a("text",{x:center_x+4*J,y:offset_top+Q*G+1.5*J,fill:r,"class":"key_text"},K.title);h.append(U),h.append(V)}if(title){var $=a("text",{x:n/2,y:5,fill:r,"text-anchor":"middle","class":"key_text"},title);h.append($)}if(d){var ee=prettyNumber(100*m/_),te="Fit: "+ee+"%",ae=a("text",{x:n/2,y:s-2,fill:r,"text-anchor":"middle","class":"key_text"},te);h.append(ae)}var re=e('<div class="chart_tip"><span class="title"></span><span class="value"></span></div>').appendTo("body");return i.on("mouseover","path.graph_piece, circle.graph_piece",function(t){re.find("span.title").html(e(this).data("title")),e(this).data("value")&&!isNaN(e(this).data("value"))?re.find("span.value").text(prettyNumber(e(this).data("value"))):re.find("span.value").html(e(this).data("value")),re.show()}),i.on("mouseleave","path.graph_piece, circle.graph_piece",function(e){re.hide()}),i.on("mousemove","path.graph_piece, circle.graph_piece",function(e){re.css({left:e.pageX-re.outerWidth()/2+"px",top:e.pageY-re.outerHeight(!0)+"px"})}),i.addClass("chart").addClass("skew_chart"),has_key&&i.addClass("has_key"),i},e.fn.drawBar=function(t,i){for(var n,s=e(this),o=i.aspect_ratio?i.aspect_ratio:2,p=100*o,c=100,d=parseInt(i.bar_spacing),h=i.colors,u=(i.background_color||"#fff",i.title),v=i.hover,_=i.rounded_tops,f=i.average_line,g="undefined"==typeof i.goal_value?null:i.goal_value,x="undefined"==typeof i.height_adjustment?0:i.height_adjustment,m=(Math.cos,Math.sin,Math.PI,e('<svg width="100%" height="100%" viewBox="0, 0, '+p+", "+c+'" xmlns="http://www.w3.org/2000/svg"></svg>').appendTo(s)),y=f||null!==g?16:0,w=f||null!==g?8:0,k=p-y,M=v&&!u?c:c-10,b=M-10,L=0,j=1+x,C=p-k+d/2,I=M,P=(k-t.length*d)/t.length,N=0;N<t.length;N++)L+=t[N].value,t[N].value+x>j&&(j=t[N].value+x);if(f||null!==g){var A;f?(n=L/t.length,A=b*(n+x)/j):(n=g,A=b*(g+x)/j);var T=a("rect",{x:p-k,y:I-A,width:k,height:A,fill:"rgba(0, 0, 0, 0.1)"});m.append(T);var Z=["M",p-k,I-A,"L",p-k-w/2,I-A+w/2,"L",0,I-A+w/2,"L",0,I-A-w/2,"L",y-w/2,I-A-w/2,"Z"],B=a("path",{d:Z.join(" "),fill:l,"class":"goal_indicator"});m.append(B);var H=a("text",{x:(y-w/2)/2,y:I-A+w/2-2,"text-anchor":"middle",fill:"#fff","class":"goal_indicator_text"},prettyNumber(n));m.append(H)}if("undefined"!=typeof n)for(var N=0;N<t.length;N++){var W=t[N],X=b*Math.min(W.value+x,n+x)/j,Y=b*(W.value+x)/j,E=h[0],O=h[h.length-1],S=v?"graph_piece":"";if(Y>X){var D=I-X,F=Y-X,Q=["M",C,D,"L",C,D-F+Math.min(P/2,F),"A",P/2,Math.min(P/2,F),"0 0 1",C+P,D-F+Math.min(P/2,F),"L",C+P,D,"Z"],R=a("path",{d:Q.join(" "),fill:O,"data-title":W.name,"data-value":W.value,"class":S});m.append(R)}var q=["M",C,I,"L",C,I-X,"L",C+P,I-X,"L",C+P,I,"Z"],z=a("path",{d:q.join(" "),fill:E,"data-title":W.name,"data-value":W.value,"class":S});if(m.append(z),!v){var G=a("text",{x:C+P/2,y:I-Y-1,fill:r,"text-anchor":"middle","class":"key_text"},prettyNumber(W.value)),J=a("text",{x:C+P/2,y:c-1,fill:r,"text-anchor":"middle","class":"key_text"},W.name);m.append(G),m.append(J)}C+=P+d}else for(var N=0;N<t.length;N++){var W=t[N],Y=b*(W.value+x)/j,K=h[N%h.length],S=v?"graph_piece":"";if(_)var U=["M",C,I,"L",C,I-Y+Math.min(P/2,Y),"A",P/2,Math.min(P/2,Y),"0 0 1",C+P,I-Y+Math.min(P/2,Y),"L",C+P,I,"Z"];else var U=["M",C,I,"L",C,I-Y,"L",C+P,I-Y,"L",C+P,I,"Z"];var V=a("path",{d:U.join(" "),fill:K,"data-title":W.name,"data-value":W.value,"class":S});if(Y>0&&m.append(V),!v){var G=a("text",{x:C+P/2,y:I-Y-1,fill:r,"text-anchor":"middle","class":"key_text"},prettyNumber(W.value)),J=a("text",{x:C+P/2,y:c-1,fill:r,"text-anchor":"middle","class":"key_text"},W.name);m.append(G),m.append(J)}C+=P+d}if(v&&u)var $=a("text",{x:p/2,y:c-2,fill:r,"text-anchor":"middle","class":"key_text"},u);if(m.append($),v){var ee=e('<div class="chart_tip"><span class="title"></span><span class="value"></span></div>').appendTo("body");s.on("mouseover","path.graph_piece",function(t){ee.find("span.title").html(e(this).data("title")),ee.find("span.value").text(prettyNumber(e(this).data("value"))),ee.show()}),s.on("mouseleave","path.graph_piece",function(e){ee.hide()}),s.on("mousemove","path.graph_piece",function(e){ee.css({left:e.pageX-ee.outerWidth()/2+"px",top:e.pageY-ee.outerHeight(!0)+"px"})})}return s.addClass("chart").addClass("bar_chart"),s},e.fn.drawLine=function(t,l){for(var i=e(this),n=l.aspect_ratio?l.aspect_ratio:2,s=100*n,o=100,p=l.colors,c=(l.background_color||"#fff",l.title),d=l.hover,h=1.5,u=l.separate_scales?l.separate_scales:!1,v="undefined"==typeof l.height_adjustment?0:l.height_adjustment,_=(Math.cos,Math.sin,Math.PI,e('<svg width="100%" height="100%" viewBox="0, 0, '+s+", "+o+'" xmlns="http://www.w3.org/2000/svg"></svg>').appendTo(i)),f=s-2*h,g=d&&!c?o:o-10,x=g-10,m=null,y=null,w=[],M=[],b=0;b<t.length;b++){w.push(null),M.push(null);for(var L=0;L<t[b].length;L++)(null==m||t[b][L].value>m)&&(m=t[b][L].value),(null==y||t[b][L].value<y)&&(y=t[b][L].value),(null==w[b]||t[b][L].value>w[b])&&(w[b]=t[b][L].value),(null==M[b]||t[b][L].value<M[b])&&(M[b]=t[b][L].value)}v=Math.max(-1*y,v),m+=v,y+=v;for(var b=0;b<t.length;b++)v=Math.max(-1*M[b],v),w[b]=w[b]+v,M[b]=M[b]+v;for(var j=[],b=0;b<t.length;b++){for(var C=t[b].length>1?f/(t[b].length-1):f,I=(s-f)/2,P=[],N=p[b],A=u?w[b]:m,L=0;L<t[b].length;L++){var T=t[b][L],Z=I,B=g-x*(T.value+v)/A,H=T.value;T.hasOwnProperty("tooltip_value")&&(H=T.tooltip_value.constructor==Array?T.tooltip_value.join(", "):T.tooltip_value),P.push(Z+","+B);var W=a("circle",{cx:Z,cy:B,r:h,fill:N,"data-title":T.name,"data-value":H,"class":"graph_piece"});j.push(W),I+=C}var X=h+","+g,Y=h+f+","+g,E=a("polygon",{points:X+" "+P.join(" ")+" "+Y,fill:N,"fill-opacity":.5}),O=a("polyline",{points:P.join(" "),fill:"none","fill-opacity":.5,stroke:N,"stroke-width":"0.5%"});_.append(O),_.append(E)}for(k=0;k<j.length;k++)_.append(j[k]);if(d&&c)var S=a("text",{x:s/2,y:o-2,fill:r,"text-anchor":"middle","class":"key_text large"},c);if(_.append(S),d){var D=e('<div class="chart_tip"><span class="title"></span><span class="value"></span></div>').appendTo("body");i.on("mouseover","polygon.graph_piece, circle.graph_piece",function(t){D.find("span.title").html(e(this).data("title")),D.find("span.value").text(e(this).data("value")),D.show()}),i.on("mouseleave","polygon.graph_piece, circle.graph_piece",function(e){D.hide()}),i.on("mousemove","polygon.graph_piece, circle.graph_piece",function(e){D.css({left:e.pageX-D.outerWidth()/2+"px",top:e.pageY-D.outerHeight(!0)+"px"})})}return i.addClass("chart").addClass("bar_chart"),i},e.fn.drawComparison=function(t,l){for(var i=e(this),n=l.aspect_ratio?l.aspect_ratio:1,s=100*n,o=100,p=l.colors,c=l.shapes,d=(l.background_color||"#fff",l.title),h=l.hover,u=h?"graph_piece":"",v=(Math.cos,Math.sin,Math.PI,e('<svg width="100%" height="100%" viewBox="0, 0, '+s+", "+o+'" xmlns="http://www.w3.org/2000/svg"></svg>').appendTo(i)),_=0,f=0,g=0;g<t.length;g++)_+=t[g].value;var x=0,m=h&&!d?o:o-10,y=m;if(_>0)for(var g=0;g<t.length;g++){var w=t[g],k=p[g%p.length],M=c[g%c.length],b=Math.round(w.value/_*100)/100,L=w.value/_*(m/100),j=Math.round(L*s*100)/100,C=Math.round(L*o*100)/100;f+=b,f>1&&(b-=.01);var I=a("path",{d:M,fill:k,"data-title":w.name,"data-value":Math.round(100*b)+"%","class":u,transform:"translate("+x+", "+(y-C)+"), scale("+L+")"});if(v.append(I),!h){var P=a("text",{x:x+j/2,y:y-C-1,fill:r,"text-anchor":"middle","class":"key_text large"},Math.round(100*b)+"%"),N=a("text",{x:x+j/2,y:o-1,fill:r,"text-anchor":"middle","class":"key_text"},w.name);v.append(P),v.append(N)}x+=j,d&&(x+=10/(t.length-1))}if(h&&d)var A=a("text",{x:s/2,y:o-2,fill:r,"text-anchor":"middle","class":"key_text"},d);if(v.append(A),h){var T=e('<div class="chart_tip"><span class="title"></span><span class="value"></span></div>').appendTo("body");i.on("mouseover","path.graph_piece",function(t){T.find("span.title").html(e(this).data("title")),T.find("span.value").text(e(this).data("value")),T.show()}),i.on("mouseleave","path.graph_piece",function(e){T.hide()}),i.on("mousemove","path.graph_piece",function(e){T.css({left:e.pageX-T.outerWidth()/2+"px",top:e.pageY-T.outerHeight(!0)+"px"})})}return i.addClass("chart").addClass("comparison_chart"),i}}(jQuery);
